<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Estudio Priónico – Confirmación</title>
<style>
:root { color-scheme: light dark; }
body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 2rem; display: grid; place-items: center; min-height: 100dvh; background: #f6f7f9; }
.card { background: #fff; max-width: 680px; width: 100%; padding: 1.5rem; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }
h1 { margin: 0 0 0.5rem; font-size: 1.5rem; }
p { line-height: 1.5; }
.status { padding: 0.25rem 0.6rem; border-radius: 999px; font-size: 0.9rem; display: inline-block; }
.ok { background: #e8f5e9; color: #1b5e20; }
.error { background: #ffebee; color: #b71c1c; }
.muted { color: #666; font-size: 0.9rem; }
.footer { margin-top: 1rem; font-size: 0.85rem; color: #666; }
</style>
</head>
<body>
<main class="card">
<h1>Gracias por tu respuesta</h1>
<p id="msg" class="muted">Procesando…</p>
<div class="footer">Este sistema respeta tu decisión y protege tu confidencialidad.</div>
</main>


<script>
(function() {
const params = new URLSearchParams(location.search);
const preStatus = params.get('status');
const preResp = params.get('response');


const msg = document.getElementById('msg');
const safe = (s) => (s||'').replace(/</g,'&lt;');


if (preStatus === 'ok' && preResp) {
// Reached via server redirect (GET flow)
const labels = { acepto: '✅ Has indicado que ACEPTAS participar.', necesito_mas_info: 'ℹ️ Has indicado que NECESITAS MÁS INFORMACIÓN.', rechazo: '❌ Has indicado que NO DESEAS PARTICIPAR.' };
msg.innerHTML = `<span class="status ok">Recibido</span> ${labels[preResp] || ''}`;
return;
}


// Direct HTML open with ?response=&id= — use POST flow
const response = params.get('response');
const id = params.get('id');
const token = params.get('token');


if (!response || !id) {
msg.innerHTML = '<span class="status error">Error</span> Falta información en el enlace.';
return;
}


fetch('/api/submit', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ response, id, token })
})
.then(async (r) => {
const data = await r.json().catch(() => ({}));
if (!r.ok) throw new Error(data.error || 'Error');
const labels = { acepto: '✅ Has indicado que ACEPTAS participar.', necesito_mas_info: 'ℹ️ Has indicado que NECESITAS MÁS INFORMACIÓN.', rechazo: '❌ Has indicado que NO DESEAS PARTICIPAR.' };
msg.innerHTML = `<span class="status ok">Recibido</span> ${labels[response] || ''}`;
})
.catch((e) => {
msg.innerHTML = `<span class="status error">Error</span> ${safe(e.message)}`;
});
})();
</script>
</body>
</html>
